<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>회원 관리</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <!-- 부트스트랩 CSS 및 JS 추가 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
</head>
<body>

<div class="modal" id="userManagementModal" data-th-fragment="school-modal">
    <div class="modal-dialog">
        <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">회원 관리</h5>
              <button aria-label="Close" class="btn-close" data-bs-dismiss="modal" type="button"></button>
            </div>
            <div class="modal-body">
              <table>
                <thead>
                <tr>
                  <th>사진</th>
                  <th>닉네임</th>
                  <th>등급</th>
                  <th>부 매니저 관리</th>
                  <th>블랙리스트 추가</th>
                </tr>
                </thead>
                <tbody id="user-list">

                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

<script>
    const userManagementModal = new bootstrap.Modal(document.getElementById('userManagementModal'));

   $(document).on('click', '.auth', function() {
    const queryString = window.location.search;
    const params = new URLSearchParams(queryString);
    const schoolNo = params.get('schoolNo');
    const userNo = $(this).parent().parent().find(".userNo").val()
    const button = this;
    $(".auth").prop('disabled', true)
    axios.post("admin/levelUpdate", {
      userNo,
      schoolNo
    })
    .then((e) => {
      if(e.status===200) {
        console.log(userNo)
        if(e.data===2) {
           $(button).text("부 매니저 임명")
           consol.log("임명")
        } else if(e.data===3) {
           $(button).text("권한 해지")
           consol.log("해지")
        }
        setTimeout(() => {
          $(".auth").prop('disabled', false)
      }, 2000);
      }
    })
  })

  $(document).on('click', '.black', function() {
    const queryString = window.location.search;
    const params = new URLSearchParams(queryString);
    const schoolNo = params.get('schoolNo');
    const userNo = $(this).parent().parent().find(".userNo").val()
    axios.post("admin/sub/blackAdd", {
      userNo,
      schoolNo
    })
    .then((e)=> {
      if(e.status===200) {
        $(this).parent().parent().empty();
        console.log("클릭")
      }
    })
  })


    function userManagementForm() {
    const queryString = window.location.search;
    const params = new URLSearchParams(queryString);
    const schoolNo = params.get('schoolNo');

    userManagementModal.show();

    axios.get("admin/userList?schoolNo="+schoolNo)
    .then((response) => {
        $("#user-list").empty();
        for(let user of response.data) {
            let text = "";
            text += "<tr>";
            text += "<td><img src='https://qryyl2ox2742.edge.naverncp.com/yNmhwcnzfw/user/" + user.users.photo + "?type=f&w=80&h=80' alt='사진'></td>";
            text += "<td>" + user.level.name + "</td>";
            if(user.levelNo === 3) {
                text += "<td><button class='btn btn-outline-danger btn-sm auth'>권한 해지</button></td>";
            } else if(user.levelNo === 2) {
                text += "<td><button class='btn btn-outline-success btn-sm auth'>부 매니저 임명</button></td>";
            }
            text += "<td><button class='btn btn-outline-secondary btn-sm black'>블랙 리스트 추가</button></td>";
            text += "</tr>";
            $("#user-list").append(text);
        }
    })
    .catch((error) => {
        console.error('Error fetching user list:', error);
    });
    }


</script>





</div>

</body>
</html>