<!DOCTYPE html>
<html lang='en'>
<head>
		<meta charset='UTF-8'>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
		<title>새 글 작성</title>
		<!-- include libraries(jQuery, bootstrap) -->
		<link href="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css" rel="stylesheet">
		<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
		<script src="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>

		<!-- include summernote css/js -->
		<link href="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote.min.css" rel="stylesheet">
		<script src="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote.min.js"></script>

		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>
</head>
<body>

<div class="modal" id="post_md_modal" data-th-fragment="postMd-modal">
		<div class="modal-dialog">
				<div class="modal-content">
						<form action="update" data-th-action="@{update}" data-th-object="${post}"
						      enctype='multipart/form-data' method='post'>
								<!-- postNo, schoolNo의 값을 넘기기 위해 히든으로 설정 -->
								<input type="hidden" name="schoolNo" data-th-value="*{schoolNo}">
								<input type="hidden" name="no" data-th-value="*{no}">
								<div>
										<!-- Summernote 에디터 -->
										<textarea data-th-text="${content}" id="summernoteContent"
										          name='content' style="display: none"></textarea>
								</div>

								<div>
										<!-- 공지로 등록하는 체크박스 -->
										<!-- gradeMd = 체크박스는 관리자만 보이게 설정 -->
										<!-- gradeMdLabel = 공지로등록이라는 텍스트는 관리자만 보이게 설정 -->
										<label for="gradeMd" id="gradeMdLabel" style="display: none;">공지로 등록</label>
										<input type="checkbox" id="gradeMd" name="post" value="1" style="display: none;">
										<button>변경</button>
								</div>
						</form>
				</div>
		</div>


		<script>
				const MdModal = new bootstrap.Modal(document.getElementById('post_md_modal'), {});

				function postMd() {

						console.log("@@@@@@==>> Md 실행완료!");

						MdModal.show();

						// Summernote 에디터를 초기화합니다.
						$('#summernoteContent').summernote({
								height: 300,
								width: 500,
								callbacks: {
										onInit: function() {
												console.log('Summernote 생성됨!');
										},
										onImageUpload: function(files) {
												let data = new FormData();
												for (const file of files) {
														data.append("files", file);
												}
												$.ajax({
														url: 'file/upload', // 파일 업로드 처리를 하는 엔드포인트 URL
														type: 'POST',
														dataType: 'json',
														contentType: false,
														processData: false,
														data: data
												}).done(function(result) {
														if (result.length == 0) {
																alert('로그인 하세요!');
																return;
														}
														// 서버에서 받은 업로드 파일 이름을 가지고 <img> 태그를 설정합니다.
														for (const attachedFile of result) {
																$('#summernoteContent').summernote('insertImage',
																		'https://kr.object.ncloudstorage.com/moyeorastorage/post/'
																		+ attachedFile.filePath);
														}
												});
										}
								}
						});
				}
		</script>

		<script>
				//				$(document).ready(function() {
				//						// "변경" 버튼 클릭 시 폼 제출 처리
				//						$("#btn_md_submit").click(function() {
				//								// 모달 내의 폼 데이터를 가져옵니다.
				//								var formData = new FormData($("#mdPostModal form")[0]);
				//
				//								console.log("@@@@@@등록 누름!", btn_md_submit);
				//
				//								// AJAX를 사용하여 폼 데이터를 서버로 제출합니다.
				//								$.ajax({
				//										type: "POST", // POST 요청
				//										url: "update",   // 데이터를 제출할 URL
				//										data: formData, // 폼 데이터
				//										contentType: false, // 컨텐츠 타입을 false로 설정하여 기본값을 사용합니다.
				//										processData: false, // processData를 false로 설정하여 데이터를 자동 처리하지 않도록 합니다.
				//
				//										// 요청이 성공하면 수행할 작업을 정의합니다.
				//										success: function(response) {
				//												// 필요한 경우 성공 메시지를 표시합니다.
				//												alert('게시글이 변경되었습니다.');
				//												// 모달을 닫습니다.
				//												$("#mdPostModal").modal("hide");
				//										},
				//										// 요청이 실패하면 수행할 작업을 정의합니다.
				//										error: function(xhr, status, error) {
				//												// 필요한 경우 실패 메시지를 표시합니다.
				//												alert('게시글 변경에 실패했습니다.');
				//										}
				//								});

				// 서버에서 사용자의 등급 정보를 전달합니다.
				var userGrade = '${userGrade}'; // "매니저" 또는 "부매니저"를 나타내는 값

				// "매니저" 또는 "부매니저"인 경우 체크박스를 보이도록 설정
				if (userGrade === 'admin' || userGrade === 'sub-admin') {
						$('#gradeMd').show();
						$('#gradeMdLabel').show();
				}
				//						});
				//				});
		</script>
</div>


</body>
</html>


