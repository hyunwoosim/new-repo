<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="stylesheet" href="/static/admin/css/header.css" type="text/css"/>
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:ital,wght@0,200..900;1,200..900&display=swap"
        rel="stylesheet"/>

  <title>moyeora - 모여라에서 취미가 맞는 친구를 사귀어 보세요!</title>
  <script src="https://kit.fontawesome.com/ee5cb5f44c.js" crossorigin="anonymous"></script>
  <script src="/static/admin/js/header.js" defer></script>
</head>

<body>
<div th:fragment="header">
  <header>
    <nav class="header">
      <div class="navbar_logo">
        <a href="">
          <img src="/static/img/moyeoraL.png" alt="moyeora로고" class="logo"/>
        </a>
      </div>

      <ul class="header_menu">
        <li><a data-th-href="@{/user/form}">회원가입</a></li>
        <li sec:authorize="isAuthenticated()">
          <a data-th-href="@{auth/logout}" onclick="logout(event)" data-th-data-csrf="${_csrf.token}"
             data-th-data-csrf-header="${_csrf.headerName}"
             data-csrf="token" data-csrf-header="headerName">로그아웃</a>
        </li>
        <li sec:authorize="isAnonymous()">
          <a data-th-href="@{/auth/form}">로그인</a>
        </li>
        <li><a data-th-href="@{/chat/gm?schoolNo=1}">gm</a></li> <!-- gm 링크 추가 -->
      </ul>

      <ul class="header_icons">
        <a href="">
          <i class="fa-solid fa-user"></i>
        </a>
      </ul>

      <!-- 사용자 사진 표시 -->
      <div data-th-if="${session.loginUser != null}">
        <img data-th-if="${session.loginUser.photo != null}"
             data-th-src="@{'https://rljiyddk2675.edge.naverncp.com/68i0l8DhXa/user/' + ${session.loginUser.photo}(type=f,w=20,h=20,ttype=jpg)}"
             src="/img/default_photo.jpeg">
        <img data-th-if="${session.loginUser.photo == null}" src="/img/default_photo.jpeg">

        <!-- 사용자 이름 표시 -->
        <span data-th-text="${session.loginUser.name}">홍길동</span>
      </div>
    </nav>
    <hr/>
  </header>
</div>

<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script>

  function displayUserInfo() {
    // 서버에서 사용자 정보를 가져오는 API를 호출합니다.
    axios.get('/user/userProfile')
      .then(function (response) {
        var userInfo = response.data;

        // 사용자의 사진과 이름을 가져와서 표시합니다.
        document.getElementById("userPhoto").src = userInfo.photo;
        document.getElementById("name").textContent = userInfo.name;
      })
      .catch(function (error) {
        console.error('Error fetching user info:', error);
      });
  }

  // 페이지 로드 시 사용자 정보를 가져와서 표시합니다.
  window.onload = displayUserInfo;
</script>

</body>
</html>