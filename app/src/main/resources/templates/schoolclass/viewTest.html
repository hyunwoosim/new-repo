<!DOCTYPE html>
<html lang='en'>
<head>
    <meta charset='utf-8'/>
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js'></script>
    <!-- FullCalendar 라이브러리의 6.1.11 버전을 가져옵니다.   -->
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@5.10.1/main.css" rel="stylesheet">
    <!--FullCalendar 라이브러리의 5.10.1 버전의 CSS 파일을 가져옵니다.    -->
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.10.1/main.js"></script>
    <!--FullCalendar 라이브러리의 5.10.1 버전을 가져옵니다.    -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.min.js"></script>
    <!--Moment.js 라이브러리의 2.18.1 버전을 가져옵니다.    -->
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.10.1/locales-all.js"></script>
    <!--FullCalendar 라이브러리의 5.10.1 버전의 로케일 파일을 가져옵니다.-->
    <link crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
          integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" rel="stylesheet">
    <script crossorigin="anonymous"
            integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
            src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script type="text/javascript" src="http://code.jquery.com/jquery-latest.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
          var calendarEl = document.getElementById('calendar');
          var calendar = new FullCalendar.Calendar(calendarEl, {
            initialView: 'dayGridMonth'
          });
          calendar.render();
        });
<!--캘린더를 초기화하고 뷰를 랜더링하는 역할을 한다.    -->
    </script>
    

</head>
<body>


<div id='calendar'></div>

<script>

    let calendar;
    
    window.onload = function() {
        // 페이지가 완전히 출력된 후 수행할 작업을 둔다.
        // 서버에서 일정 정보를 가져오는 작업
        
        // 1. AJAX로 서버에서 해당 월의 일정 정보를 가져온다.
        // 2. 서버에서 받은 JSON 데이터를 자바 객체로 바꾼 후
        //    그 일정을 캘린더에 등록한다.
        console.log("test....ok!");
        
        
        $.ajax({
            url: 'calendar?schoolNo=1',
            type: 'GET',
            dataType: 'json',
            contentType: false,
            processData: false,
            
        }).done(function(result) {
            for (let classEvent of result) {
                calendar.addEvent({
                title: classEvent.name,
                start: classEvent.startAt,
                end : classEvent.endedAt,
                allDay: true,
                extendedProps: {
                    classNo: classEvent.no
                }
             });
            }
            console.log("@@@@@@@@@@@@@@@@@@");
            console.log(result);
        });
    };
    
    document.addEventListener('DOMContentLoaded', function() {
        var calendarEl = document.getElementById('calendar');
        calendar = new FullCalendar.Calendar(calendarEl, {
            initialView : 'dayGridMonth', // 초기 로드 될때 보이는 캘린더 화면(기본 설정: 달)
            headerToolbar : { // 헤더에 표시할 툴 바
                start : 'prev next today add',
                center : 'title',
                end : 'dayGridMonth,dayGridWeek,dayGridDay'
            },
            customButtons: {
                add: {
                    text: '일정등록',
                    click: function() {
                        myModal1();
                    }
                }
            },

            titleFormat : function(date) {
                return date.date.year + '년 ' + (parseInt(date.date.month) + 1) + '월';
            },
            //initialDate: '2021-07-15', // 초기 날짜 설정 (설정하지 않으면 오늘 날짜가 보인다.)
            selectable : false, // 달력 일자 드래그 설정가능
            droppable : false,
            editable : false,
            nowIndicator: true, // 현재 시간 마크
            locale: 'ko' , // 한국어 설정
            dateClick: function(info) {
                myModal1();
            },
            
<!--            바를 클릭하면 나오는 부분 view부분-->
            eventClick: function(info) {
                viewModal1();
                var eventObj = info.event;
                console.log(info.event);
                 console.log(eventObj);
                 var classNo = eventObj.extendedProps.classNo;
                    console.log(classNo);
                 
                    
                      axios({
                        method: 'GET',
                        url: '/schoolclass/findByNo',
                        params: {
                            classNo: classNo
                        },
                        responseType:'json'
                      })
                        .then(function (response) {
                            var responseData = response.data;
                            console.log(responseData);
                            
                            document.getElementById('name').textContent = responseData.name;
                            document.getElementById('content').textContent = responseData.content;
                            document.getElementById('levelName').textContent = responseData.level.levelName;
                            document.getElementById('nickname').textContent = responseData.user.nickname;
                            document.getElementById('location').textContent = responseData.location;
                            document.getElementById('locationDetail').textContent = responseData.locationDetail;
                            document.getElementById('member').textContent = responseData.member;
                            document.getElementById('nowMemberCount').textContent = responseData.nowMemberCount;
                            document.getElementById('startAt').textContent = responseData.startAt;
                            
                            
                            console.log("===============================================");
                            
                            var photoElement = document.getElementById('photo');
                                if (responseData.photo) {
                                    photoElement.src = 'https://qryyl2ox2742.edge.naverncp.com/yNmhwcnzfw/schoolclass/' + responseData.photo + '?type=f&w=160&h=160';
                                   
                                    console.log("=======================사진========================");
                                } else {
                                    photoElement.src = '/img/default-photo.jpeg';
                                   
                                    console.log("=====================기본 사진==========================");
                                }
                                console.log(responseData.photo);
                        })
                        .catch(function (error) {
                            console.error('에러 발생:', error);
                        });
                        
            },
        });
        
        calendar.render();
    });

</script>



<div class="modal" id="viewModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">일정등록</h5>
        <button aria-label="Close" class="btn-close" data-bs-dismiss="modal" type="button"></button>
      </div>
      <div class="modal-body">
          
          <div>
<!--              <img id="photo"></img>-->
          </div>
          
            
              
          <div>
                제목: <span id="name" data-th-text="${name}"></span>
          </div>
          <div>
                nickname: <span id="nickname" data-th-text="${nickname}"></span>
          </div>
          <div>
                content: <span id="content" data-th-text="${content}"></span>
          </div>
          <div>
                levelName: <span id="levelName" data-th-text="${levelName}"></span>
          </div>
          <div>
                location: <span id="location" data-th-text="${location}"></span>
          </div>
          <div>
                locationDetail: <span id="locationDetail" data-th-text="${locationDetail}"></span>
          </div>
          <div>
                photo: <img id="photo">
          </div>
           <div>
                member: <span id="member" data-th-text="${member}"></span>
          </div>
          <div>
                nowMemberCount: <span id="nowMemberCount" data-th-text="${nowMemberCount}"></span>
          </div>
          <div>
                startAt: <span id="startAt" data-th-text="${startAt}" data-th-format="YYYY-MM-DD"></span>
          </div>
          
         
      </div>
      
    </div>
  </div>
</div>
<script>
    let viewModal;
        function viewModal1() {
             viewModal = new bootstrap.Modal(document.getElementById('viewModal'), {})
            console.log('모달을 표시합니다.');
            viewModal.show();
        };
        
         function closeModal() {
            viewModal.hide();
        };
    
    
</script>


</body>
</html>